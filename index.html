<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Doctor Car Pro ‚Äî Lux UI</title>
<meta name="theme-color" content="#0b0f12">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* ====== PALETA TIPO APP PREMIUM (teal/verde, oscuro, glass) ====== */
:root{
  --bg0:#0b0f12; --bg1:#0e151a; --panel:#111a22; --ink:#e9edf4; --muted:#9aa4b2;
  --teal1:#66f0cf; --teal2:#1dd6b3; --teal3:#109e8b; --accent:#ff8f3d;
  --green:#22c55e; --red:#ef4444; --yellow:#f59e0b; --line:#1f2a33; --radius:16px;
  --shadow:0 12px 28px rgba(0,0,0,.45);
}
*{box-sizing:border-box} html,body{height:100%} body{
  margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", Inter, Roboto, Arial;
  background: radial-gradient(1200px 700px at 70% -10%, #113a39 0%, transparent 60%),
              radial-gradient(900px 600px at -10% 0%, #12313b 0%, transparent 60%),
              var(--bg0);
  color:var(--ink); letter-spacing:.2px;
}
header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(140%) blur(10px);
  background:rgba(10,14,18,.55); border-bottom:1px solid var(--line)}
.topbar{display:flex; align-items:center; gap:12px; padding:12px 14px}
.brand{font-weight:800; letter-spacing:.4px}
.badge{font-size:12px; color:var(--muted)}
.logo{width:36px; height:36px; border-radius:10px; background:#000; object-fit:cover}
.grow{flex:1}
.btn{display:inline-flex; align-items:center; gap:10px; border-radius:12px; padding:10px 14px; border:1px solid var(--line); cursor:pointer}
.btn.primary{background:linear-gradient(180deg,var(--teal1),var(--teal2)); color:#05211b; font-weight:800; border:none}
.btn.ghost{background:#111825; color:var(--ink)}
.backBtn{display:none}
.tag{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; color:var(--muted); font-size:12px}
.container{max-width:960px; margin:18px auto; padding:0 14px}
.card{background:linear-gradient(180deg,#0f1922,#0c141a); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px; margin-bottom:16px}
.h{display:flex; align-items:center; gap:10px; margin-bottom:10px}
.h h2{margin:0; font-size:18px}

/* ====== HOME estilo ‚Äúgaraje‚Äù ====== */
.hero{
  display:grid; grid-template-columns:1fr; gap:14px;
}
.heroTop{
  display:grid; grid-template-columns: 1fr auto; gap:14px; align-items:center;
  background:linear-gradient(120deg, rgba(17,49,55,.8), rgba(14,24,32,.8));
  border:1px solid var(--line); border-radius:20px; padding:16px;
}
.car{
  display:grid; grid-template-columns: 88px 1fr; gap:14px; align-items:center;
}
.carImg{width:88px; height:64px; border-radius:14px; background:#0a1016; display:grid; place-items:center; border:1px solid var(--line)}
.carImg img{max-width:86px; max-height:62px; object-fit:cover}
.carMeta b{display:block; font-size:16px}
.carMeta small{color:var(--muted)}
.kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
.kpi{
  background:#0f1722; border:1px solid var(--line); border-radius:14px; padding:12px;
}
.kpi .v{font-size:18px; font-weight:800}
.kpi .l{font-size:12px; color:var(--muted)}
.cta{display:flex; gap:10px; align-items:center}

/* ====== Secciones tipo screenshot ====== */
.sectionTitle{font-weight:800; margin:0 0 10px}
.listCards{display:grid; gap:10px}
.cardRow{
  background:#0f1722; border:1px solid var(--line); border-radius:14px; padding:14px;
  display:flex; align-items:center; justify-content:space-between;
}
.cardRow .name{font-weight:700}
.cardRow .sub{font-size:12px; color:var(--muted)}
.status{font-size:12px; padding:4px 10px; border-radius:999px; border:1px solid var(--line);}
.status.pending{color:#ffb4a8; border-color:#533; background:rgba(255,68,68,.07)}
.status.ok{color:#8ff1bf; border-color:#1f483a; background:rgba(34,197,94,.06)}

/* ====== Brands ====== */
.brandSearch{position:sticky; top:68px; z-index:10; backdrop-filter: blur(6px); padding:8px 0}
.brandList{background:linear-gradient(180deg,#0f1922,#0b1218); border:1px solid var(--line); border-radius:16px; overflow:hidden}
.brandItem{display:flex; gap:12px; align-items:center; padding:12px 14px; border-bottom:1px solid var(--line)}
.brandItem:last-child{border-bottom:none}
.brandLogo{width:26px; height:26px; border-radius:6px; background:#05090d; display:grid; place-items:center; border:1px solid var(--line)}
.brandItem b{flex:1}

/* ====== Charts ====== */
.canvasWrap{background:#0f1722; border:1px solid var(--line); border-radius:14px; padding:10px}

/* Utilidades */
.hidden{display:none!important}
.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
hr{border:0; border-top:1px solid var(--line); opacity:.6; margin:10px 0}
@media (max-width:800px){ .kpis{grid-template-columns:repeat(3,1fr)} .heroTop{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="topbar">
    <button id="btnBackHome" class="btn ghost backBtn">‚Üê Men√∫</button>
    <img id="appLogo" class="logo" alt="logo"/>
    <div>
      <div class="brand">Doctor Car Pro</div>
      <div class="badge">OBD-II ‚Ä¢ ELM327</div>
    </div>
    <span class="grow"></span>
    <span id="connStatus" class="tag">Desconectado</span>
    <button id="btnConnect" class="btn primary">Conectar</button>
    <button id="btnDisconnect" class="btn ghost hidden">Desconectar</button>
  </div>
</header>

<div class="container">
  <!-- HOME / GARAGE -->
  <section id="page-home" class="card">
    <div class="hero">
      <div class="heroTop">
        <div class="car">
          <div class="carImg"><img id="carPhoto" alt="Car"/></div>
          <div class="carMeta">
            <b id="carName">Toyota Camry</b>
            <small id="carYear">2019 ‚Ä¢ No conectado</small>
          </div>
        </div>
        <div class="cta">
          <button id="btnConnect2" class="btn primary">Connect to OBD2</button>
          <button id="btnEditCar" class="btn ghost">Editar auto</button>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="v mono" id="kpiRPM">‚Äî</div><div class="l">RPM</div></div>
        <div class="kpi"><div class="v mono" id="kpiSPD">‚Äî</div><div class="l">Speed</div></div>
        <div class="kpi"><div class="v mono" id="kpiECT">‚Äî</div><div class="l">Coolant</div></div>
      </div>

      <div class="card">
        <h3 class="sectionTitle">OBD2 scanner</h3>
        <div class="cardRow">
          <div>
            <div class="name">Accede a datos y controla tu veh√≠culo</div>
            <div class="sub">Usa Web Serial o Web Bluetooth</div>
          </div>
          <button id="btnInit" class="btn ghost">Inicializar ECU</button>
        </div>
      </div>

      <div class="card">
        <h3 class="sectionTitle">Sensor Data / PIDs</h3>
        <div class="listCards" id="pidsList">
          <div class="cardRow"><div><div class="name">Ignition Status</div><div class="sub" id="pidIGN">‚Äî</div></div></div>
          <div class="cardRow"><div><div class="name">Battery Voltage</div><div class="sub" id="pidVBAT">‚Äî</div></div></div>
          <div class="cardRow"><div><div class="name">Vehicle Protocol</div><div class="sub" id="pidPROTO">‚Äî</div></div></div>
          <div class="cardRow"><div><div class="name">VIN Code</div><div class="sub mono" id="pidVIN">‚Äî</div></div></div>
          <div class="cardRow"><div><div class="name">Fuel System Status</div><div class="sub" id="pidFUEL">‚Äî</div></div></div>
        </div>
      </div>

      <div class="card">
        <h3 class="sectionTitle">Car Codes</h3>
        <div id="dtcContainer" class="listCards">
          <div class="cardRow"><div><div class="name mono">‚Äî</div><div class="sub">Sin c√≥digos</div></div><span class="status ok">OK</span></div>
        </div>
        <div class="cta" style="margin-top:10px">
          <button id="btnScanDTC" class="btn primary">Leer DTC</button>
          <button id="btnClearDTC" class="btn ghost">Borrar DTC</button>
        </div>
      </div>

      <div class="card">
        <h3 class="sectionTitle">Charts</h3>
        <div class="canvasWrap"><canvas id="chartRPM" height="110"></canvas></div>
        <div class="canvasWrap" style="margin-top:10px"><canvas id="chartSPD" height="110"></canvas></div>
      </div>

      <div class="card">
        <h3 class="sectionTitle">Car brand</h3>
        <div class="brandSearch">
          <input id="brandSearch" placeholder="Brand name" style="width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:#0f1722; color:var(--ink)"/>
        </div>
        <div id="brandList" class="brandList"></div>
      </div>
    </div>
  </section>

  <!-- UPGRADE / WHATSAPP -->
  <section id="page-upgrade" class="card hidden">
    <div class="h"><h2>Soporte y mejoras</h2><span class="tag">Contacto directo</span></div>
    <p>¬øNecesitas una funci√≥n nueva, soporte o integraci√≥n? Comun√≠cate por WhatsApp con el desarrollador:</p>
    <a class="btn primary" href="https://wa.me/17876643079" target="_blank" rel="noopener">üí¨ WhatsApp: 787-664-3079</a>
  </section>
</div>

<footer style="text-align:center; opacity:.7; font-size:12px; padding:28px 0">¬© <span id="year"></span> Doctor Car Pro</footer>

<script>
/* ====== Hook m√≠nimo para reutilizar tu l√≥gica OBD ====== */
const $ = s=>document.querySelector(s);
const $$ = s=>[...document.querySelectorAll(s)];
const BRAND_KEY='dcp.brand', AUTH_KEY='dcp.auth', PREF_KEY='dcp.prefs';

const S = { t0:Date.now(), series:{t:[],rpm:[],spd:[]}, charts:{} };

/* Back button: visible fuera de Home si llegas a m√°s pantallas */
function go(p){ ['home','upgrade'].forEach(id=>$('#page-'+id).classList.add('hidden')); $('#page-'+p).classList.remove('hidden'); $('#btnBackHome').style.display = (p!=='home')?'inline-flex':'none'; window.scrollTo(0,0); }
$('#btnBackHome').onclick=()=>go('home');
document.getElementById('year').textContent=new Date().getFullYear();

/* Persistencia b√°sica de foto/nombre auto (adem√°s de tu tema/logo) */
const GARAGE_KEY='dcp.garage';
function loadGarage(){ return JSON.parse(localStorage.getItem(GARAGE_KEY)||'{"name":"Toyota Camry","year":"2019","photo":""}'); }
function saveGarage(g){ localStorage.setItem(GARAGE_KEY, JSON.stringify(g)); }
function paintGarage(){
  const g=loadGarage();
  $('#carName').textContent=g.name||'‚Äî';
  $('#carYear').textContent=(g.year?g.year+' ‚Ä¢ ':'') + ( $('#connStatus').textContent || '‚Äî' );
  if(g.photo) $('#carPhoto').src=g.photo; else $('#carPhoto').src='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="120" height="80"><rect width="100%" height="100%" fill="#0a0f14"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" fill="#66f0cf" font-family="Arial" font-size="16">Car</text></svg>`);
}
paintGarage();
$('#btnEditCar').onclick=async ()=>{
  const g=loadGarage();
  const name=prompt('Modelo', g.name||'');
  const year=prompt('A√±o', g.year||'');
  if(name!==null) g.name=name;
  if(year!==null) g.year=year;
  // permite subir imagen
  const input=document.createElement('input'); input.type='file'; input.accept='image/*';
  input.onchange=async e=>{
    const f=e.target.files[0]; if(!f) return save();
    const b=await f.arrayBuffer();
    const u=await new Promise(r=>{ const fr=new FileReader(); fr.onload=()=>r(fr.result); fr.readAsDataURL(new Blob([b],{type:f.type})) });
    g.photo=u; save();
  };
  function save(){ saveGarage(g); paintGarage(); }
  input.click();
};

/* ====== Dummy glue para los botones (reemplaza con tu Transport.* si ya los tienes globales) */
async function connect(){ try{
  /* Llama aqu√≠ a Transport.connect(...) si ya lo tienes. */
  $('#connStatus').textContent='Conectado';
  $('#btnConnect').classList.add('hidden');
  $('#btnDisconnect').classList.remove('hidden');
  $('#carYear').textContent = (loadGarage().year||'') + ' ‚Ä¢ Conectado';
}catch(e){ alert(e.message);} }
async function disconnect(){ $('#connStatus').textContent='Desconectado'; $('#btnConnect').classList.remove('hidden'); $('#btnDisconnect').classList.add('hidden'); paintGarage(); }
$('#btnConnect').onclick=connect; $('#btnConnect2').onclick=connect; $('#btnDisconnect').onclick=disconnect;

/* ====== KPIs + Chart.js (usa tus series cuando leas PIDs) ====== */
function initCharts(){
  const base=(label)=>({type:'line',data:{labels:S.series.t,datasets:[{label,data:[],borderWidth:2,pointRadius:0,tension:.25} ]},options:{animation:false,responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#cfe'}}},scales:{x:{ticks:{color:'#9aa'},grid:{color:'#1b2530'}},y:{ticks:{color:'#9aa'},grid:{color:'#1b2530'}}}}});
  S.charts.rpm=new Chart($('#chartRPM').getContext('2d'), base('RPM'));
  S.charts.spd=new Chart($('#chartSPD').getContext('2d'), base('Speed'));
}
initCharts();

// Simulador visual: actualiza cada 0.8s (reempl√°zalo por tus lecturas reales pid010C, 010D, 0105)
setInterval(()=>{
  const t=(Date.now()-S.t0)/1000; const rpm=Math.round(650+Math.random()*1500); const spd=Math.round(Math.random()*80); const ect=80+Math.round(Math.random()*20);
  $('#kpiRPM').textContent=rpm+' rpm';
  $('#kpiSPD').textContent=spd+' kph';
  $('#kpiECT').textContent=ect+' ¬∞C';
  S.series.t.push(t); S.series.rpm.push(rpm); S.series.spd.push(spd);
  S.charts.rpm.data.labels=S.series.t; S.charts.rpm.data.datasets[0].data=S.series.rpm; S.charts.rpm.update('none');
  S.charts.spd.data.labels=S.series.t; S.charts.spd.data.datasets[0].data=S.series.spd; S.charts.spd.update('none');
},800);

/* ====== DTC UI (p√°sale tu lista real cuando pulses Leer DTC) ====== */
function paintDTC(list){
  const box=$('#dtcContainer'); if(!list.length){ box.innerHTML='<div class="cardRow"><div><div class="name mono">‚Äî</div><div class="sub">Sin c√≥digos</div></div><span class="status ok">OK</span></div>'; return; }
  box.innerHTML=list.map(x=>`<div class="cardRow"><div><div class="name mono">${x.code}</div><div class="sub">${x.desc||''}</div></div><span class="status ${x.state==='pending'?'pending':'ok'}">${x.state||''}</span></div>`).join('');
}
$('#btnScanDTC').onclick=()=> paintDTC([
  {code:'P0300', desc:'Random/Multiple Cylinder Misfire Detected', state:'pending'},
  {code:'P0420', desc:'Catalyst System Efficiency Below Threshold (Bank 1)', state:'archive'}
]);
$('#btnClearDTC').onclick=()=> paintDTC([]);

/* ====== Brands con buscador ====== */
const BRANDS=["Abarth","Acura","Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chevrolet","Chrysler","Citro√´n","Dacia","Dodge","Ferrari","Fiat","Ford","Genesis","GMC","Honda","Hyundai","Infiniti","Jaguar","Jeep","Kia","Lamborghini","Lancia","Land Rover","Lexus","Lincoln","Maserati","Mazda","McLaren","Mercedes-Benz","MINI","Mitsubishi","Nissan","Opel","Peugeot","Porsche","Ram","Renault","Rolls-Royce","Saab","Seat","≈†koda","Subaru","Suzuki","Tesla","Toyota","Volkswagen","Volvo"];
function renderBrands(filter=''){
  const list=BRANDS.filter(b=>b.toLowerCase().includes(filter.toLowerCase()));
  $('#brandList').innerHTML=list.map(b=>`<div class="brandItem"><div class="brandLogo">üöó</div><b>${b}</b><span class="sub">Tap to select</span></div>`).join('');
}
renderBrands();
$('#brandSearch').oninput=e=>renderBrands(e.target.value);

/* ====== Protocolo, VIN y otros (placeholders que puedes mapear a tus funciones) ====== */
$('#pidPROTO').textContent='ISO 15765-4 (CAN 11/500)';
$('#pidVIN').textContent='‚Äî';
$('#pidVBAT').textContent='13.8 V';
$('#pidIGN').textContent='OFF';
$('#pidFUEL').textContent='OBD2_FUEL_SYSTEM_STATUS_02';
</script>
</body>
</html>
